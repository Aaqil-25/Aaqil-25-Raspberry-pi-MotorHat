!/usr/bin/python
from Raspi_MotorHAT import Raspi_MotorHAT, Raspi_DCMotor
from evdev import InputDevice , categorize, ecodes
from select import select

import time
import atexit

dev = InputDevice('/dev/input/event0') 
print(dev)

# create a default object, no changes to I2C address or frequency
mh = Raspi_MotorHAT(addr=0x6f)

# recommended for auto-disabling motors on shutdown!
def turnOffMotors():
	mh.getMotor(1).run(Raspi_MotorHAT.RELEASE)
	mh.getMotor(2).run(Raspi_MotorHAT.RELEASE)
	mh.getMotor(3).run(Raspi_MotorHAT.RELEASE)
	mh.getMotor(4).run(Raspi_MotorHAT.RELEASE)

atexit.register(turnOffMotors)

def forward():
        mh.getMotor(1).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(2).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(3).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(4).run(Raspi_MotorHAT.FORWARD)

def back():
        mh.getMotor(1).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(2).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(3).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(4).run(Raspi_MotorHAT.BACKWARD)

def left():
        mh.getMotor(1).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(2).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(3).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(4).run(Raspi_MotorHAT.BACKWARD)

def right():
        mh.getMotor(1).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(2).run(Raspi_MotorHAT.FORWARD)
	mh.getMotor(3).run(Raspi_MotorHAT.BACKWARD)
	mh.getMotor(4).run(Raspi_MotorHAT.FORWARD)


################################# DC motor test!
myMotor1 = mh.getMotor(1)
myMotor2 = mh.getMotor(2)
myMotor3 = mh.getMotor(3)
myMotor4 = mh.getMotor(4)
# set the speed to start, from 0 (off) to 255 (max speed)
myMotor1.setSpeed(50)
myMotor2.setSpeed(50)
myMotor3.setSpeed(50)
myMotor4.setSpeed(50)


myMotor1.run(Raspi_MotorHAT.FORWARD);
myMotor1.run(Raspi_MotorHAT.RELEASE);


while (True):

        for event in dev.read_loop():

            if event.code == 103:
                print "Forward"
                print(event.value)     #    myMotor.run(Raspi_MotorHAT.FORWARD)
                forward();
	        time.sleep(0.5)
            elif event.code == 108:
                print  "Back"
                print(event.value)     # myMotor.run(Raspi_MotorHAT.BACKWARD)
                back();
	        time.sleep(0.5)
            elif event.code == 106:
                print "right"
                print(event.value)
               #   right();
                #  time.sleep(0.5)
            elif event.code == 105:
                print "left"
                print(event.value)
                #  left();
                #  time.sleep(0.5)
            elif event.code == 28:
                print "Stop"
                #  turnOffMotors();

